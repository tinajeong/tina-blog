---
title: 'Typescript - ë°ì½”ë ˆì´í„°'
thumbSrc: '/static/images/typescript.webp'
date: '2022-07-10'
tags: ['typescript','decorator','design pattern']
draft: false
summary: 'íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ì„œì˜ ë°ì½”ë ˆì´í„° ìš©ë²•ì„ ì •ë¦¬í•©ë‹ˆë‹¤.'
images: ['/static/images/typescript.webp']
---

# ğŸ“Œ ëª©ì°¨

![typescript](/static/images/typescript.webp)

---


## íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë°ì½”ë ˆì´í„°ë€?
ì½”ë“œë¥¼ í†µí•´ ì½”ë“œë¥¼ ì‘ì„±í•´ì£¼ëŠ” ë©”íƒ€í”„ë¡œê·¸ë˜ë°ì˜ ìš©ë¡€ì´ë©°,  
ë°ì½”ë ˆì´í„°ëŠ” ì–´ë…¸í…Œì´ì…˜ í˜•íƒœë¡œ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” íŠ¹ë³„í•œ ì¢…ë¥˜ì˜ ì„ ì–¸ì´ë‹¤. 
ë°ì½”ë ˆì´í„°ëŠ” ë³´í†µ í´ë˜ìŠ¤ ë‹¨ìœ„ë¡œ ì‚¬ìš©ë˜ë©°, ë©”ì†Œë“œ, ì ‘ê·¼ì, í”„ë¡œí¼í‹° ë“±ì—ë„ ì‚¬ìš©ëœë‹¤.

## ë°ì½”ë ˆì´í„° ì‚¬ìš© ì„¤ì •í•˜ê¸°
ë°ì½”ë ˆì´í„°ëŠ” **ECMAScript**ì— ìƒˆë¡œ ì¶”ê°€ëœ ì‹¤í—˜ì ì¸ íŠ¹ì§•ì´ê¸° ë•Œë¬¸ì—, typescriptì—ì„œëŠ” `tsconfig.json` íŒŒì¼ì—ì„œ `experimentalDecorators`ì˜µì…˜ì„ trueë¡œ ë°”ê¿”ì¤€ë‹¤.
```json
...
"experimentalDecorators" : true,
...
```

## ë°ì½”ë ˆì´í„° ì •ì˜í•˜ê¸°
ë°ì½”ë ˆì´í„°ëŠ” ì•„ë˜ `Logger` ì²˜ëŸ¼ ë³´í†µ **ëŒ€ë¬¸ì**ë¡œ ë„¤ì´ë°í•œë‹¤. 
```javascript
function Logger(contructor : Function) {
    console.log("Logging...");
    console.log(contructor);
}

@Logger
class Person {
    name = "Tina";

    constructor() {
          console.log("Creating Person Object...");
    }
 }

const person = new Person();
```

### ì‹¤í–‰ê²°ê³¼
```
> "Logging..." 
> class Person {
    constructor() {
        this.name = "Tina";
        console.log("Creating Person Object...");
    }
} 
> "Creating Person Object..." 
```
ë°ì½”ë ˆì´í„°ë¥¼ ì ìš©í•˜ë©´ ì¸ìŠ¤í„´ìŠ¤í™”***instanciation***ê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šì•˜ì„ ë•Œë„, 
**ëŸ°íƒ€ì„ì—** ë°ì½”ë ˆì´í„°ê°€ ì ìš©ëœ í´ë˜ìŠ¤ê°€ ì •ì˜ëœ ì§€ì ì— ì‹¤í–‰ëœë‹¤. 


## ë°ì½”ë ˆì´í„° íŒ©í† ë¦¬
ë°ì½”ë ˆì´í„° íŒ©í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´, íŒŒë¼ë¯¸í„°ê°’ì„ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤ëŠ” ìœ ì—°ì„±ì´ ìƒê¸´ë‹¤. íŒ©í† ë¦¬í•¨ìˆ˜ë¥¼ í•˜ê³  í•˜ê¸° ìœ„í•´ì„œëŠ”, 
ìœ„ ì½”ë“œì—ì„œ íŒŒë¼ë¯¸í„°ê°’ì„ ì „ë‹¬í•˜ê³ ì í•˜ëŠ” `logString`ìœ¼ë¡œ ë³€ê²½í•˜ê³ , í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ë„ë¡ ë³€ê²½í•œë‹¤.
```typescript
function Logger(logString: string) { // ë°ì½”ë ˆì´í„° íŒ©í† ë¦¬í•¨ìˆ˜
  return function(constructor: Function) { // ë°ì½”ë ˆì´í„° í•¨ìˆ˜
    console.log(logString);
    console.log(constructor);
  };
}

@Logger('LOGGING - PERSON')
class Person {
  name = 'Tina';

  constructor() {
    console.log('Creating Person object...');
  }
}

const pers = new Person();
```


### ì‹¤í–‰ê²°ê³¼

```shell
>"LOGGING - PERSON" 
> class Person {
    constructor() {
        this.name = 'Tina';
        console.log('Creating Person object...');
    }
} 
>"Creating Person 
```

### DOM ë Œë”ë§ì— ë°ì½”ë ˆì´í„° íŒ©í† ë¦¬ ì‚¬ìš©í•˜ê¸°
```typescript
function WithTemplate(template: string, hookId: string) {
  return function(constructor: any) {
    const hookEl = document.getElementById(hookId);
    const p = new constructor();
    if (hookEl) {
      hookEl.innerHTML = template;
      hookEl.querySelector('h1')!.textContent = p.name;
    }
  }
}

@WithTemplate('<h1>My Person Object</h1>', 'app')
class Person {
  name = 'Tina';

  constructor() {
    console.log('Creating person object...');
  }
}

const pers = new Person();
console.log(pers);
```
`WithTemplate`ë¼ëŠ” ë°ì½”ë ˆì´í„°ì˜ ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë Œë”ë§í•  templateì„ ë„£ê³ , ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì—ëŠ” ì ‘ê·¼í•  ìš”ì†Œë¥¼ ì§€ì •í•´ ì‚¬ìš©ìì˜ ì´ë¦„ì„ í™”ë©´ì— ë Œë”ë§í•  ìˆ˜ ìˆë„ë¡ 
ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ë‹¤. ì•µê·¤ëŸ¬ì˜ ë Œë”ë§ ë°©ì‹ë„ ì´ì™€ ìœ ì‚¬í•œ ì•„ì´ë””ì–´ë¥¼ ê°€ì§„ë‹¤. 

## ë°ì½”ë ˆì´í„°ì˜ ì‹¤í–‰ìˆœì„œ
ì—¬ëŸ¬ê°œì˜ ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì„ ì–¸ìˆœì„œì™€ ì‹¤í–‰ìˆœì„œê°€ ë°˜ëŒ€ë¼ëŠ” ì ì— ìœ ì˜í•œë‹¤. 

```typescript
function Logger(logString: string) {
  console.log('LOGGER FACTORY');
  return function(constructor: Function) {
    console.log(logString);
    console.log(constructor);
  };
}

function WithTemplate(template: string, hookId: string) {
  console.log('TEMPLATE FACTORY');
  return function(constructor: any) {
    console.log('Rendering template');
    const hookEl = document.getElementById(hookId);
    const p = new constructor();
    if (hookEl) {
    hookEl.innerHTML = template;
      hookEl.querySelector('h1')!.textContent = p.name;
    }
  }
}

@Logger('LOGGING')
@WithTemplate('<h1>My Person Object</h1>', 'app')
class Person {
  name = 'Tina';

  constructor() {
    console.log('Creating person object...');
  }
}
```

### ì‹¤í–‰ê²°ê³¼
```
>"LOGGER FACTORY" 
>"TEMPLATE FACTORY" 
>"Rendering template" 
>"Creating person object..." 
>"LOGGING" 
>class Person {
    constructor() {
        this.name = 'Tina';
        console.log('Creating person object...');
    }
```
ì„ ì–¸ëœ ìˆœì„œëŒ€ë¡œ Logger íŒ©í† ë¦¬ ë©”ì„¸ì§€ê°€ ì¶œë ¥ë˜ê³ , Template ë©”ì„¸ì§€ê°€ ì¶œë ¥ë˜ì§€ë§Œ, 
ì‹¤ì œ ë°ì½”ë ˆì´í„° ë©”ì†Œë“œëŠ” Template ì—ì„œ Rendering ì•„ë˜ì—ì„œë¶€í„° ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì— ìœ ì˜í•œë‹¤. 


## ì†ì„± ë°ì½”ë ˆì´í„°
ì„œë‘ì— ì–¸ê¸‰í–ˆë“¯ì´, ì†ì„±, ë©”ì†Œë“œ, ì ‘ê·¼ì œì–´ì, íŒŒë¼ë¯¸í„°ì— ë°ì½”ë ˆì´í„°ë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤.
```typescript
function Log(target: any, propertyName: string | Symbol) {
  console.log('Property decorator!');
  console.log(target, propertyName);
}

class Product {
  @Log
  title: string;
  private _price: number;

  set price(val: number) {
    if (val > 0) {
      this._price = val;
    } else {
      throw new Error('Invalid price - should be positive!');
    }
  }

  constructor(t: string, p: number) {
    this.title = t;
    this._price = p;
  }

  getPriceWithTax(tax: number) {
    return this._price * (1 + tax);
  }
}
```

### ì‹¤í–‰ê²°ê³¼ 
```
> "Property decorator!" 
```
ë§ˆì°¬ê°€ì§€ë¡œ, ì¸ìŠ¤í„´ìŠ¤í™”***instanciation***ì—†ì´ë„ ì„ ì–¸ê³¼ í•¨ê»˜ ë°ì½”ë ˆì´í„°ê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

## ë§¤ê°œë³€ìˆ˜ ë°ì½”ë ˆì´í„°
```typescript
function Log4(target: any, name: string | Symbol, position: number) {
  console.log('Parameter decorator!');
  console.log(target);
  console.log(name);
  console.log(position);
}
class Product {
  ...
  getPriceWithTax(@Log4 tax: number) {
    return this._price * (1 + tax);
  }
}
```

### ì‹¤í–‰ê²°ê³¼
```
> "Parameter decorator!" 
> Product: {} 
> "getPriceWithTax" 
> 0 
```
## í´ë˜ìŠ¤ ë°ì½”ë ˆì´í„°ì—ì„œ í´ë˜ìŠ¤ ë°˜í™˜í•˜ê³  ë³€ê²½í•˜ê¸°
ë°ì½”ë ˆì´í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í´ë˜ìŠ¤ì— ì¢…ì†ëœë‹¤. ì¸ìŠ¤í„´ìŠ¤í™”***instanciation***ë˜ì—ˆì„ë•Œ ë°ì½”ë ˆì´í„°ë„ ìƒì„±ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, 
í´ë˜ìŠ¤ê°€ ì„ ì–¸ëœ ì‹œì ì—, ë©”ì†Œë“œê°€ ì„ ì–¸ëœ ì‹œì ì—, ì ‘ê·¼ì œì–´ìê°€ ì„ ì–¸ëœ ì‹œì ì— ì ìš©ëœ ë°ì½”ë ˆì´í„°ë„ í•¨ê»˜ ì„¤ì •ëœë‹¤. 

ì´ ë°ì½”ë ˆì´í„°ë¥¼ ì´ìš©í•´, constructorí•¨ìˆ˜ë¥¼ ì»¤ìŠ¤í…€í•  ìˆ˜ ìˆë‹¤. ì œë„¤ë¦­ì„ ì´ìš©í•´ ì•ì„œ Personì—ì„œ ì‚¬ìš©ë˜ì—ˆë˜ 
ìƒì„±ìë¡œì§ì„ ëŒ€ì²´í•˜ê³ , ì»¤ìŠ¤í…€í•´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```typescript
function WithTemplate(template: string, hookId: string) {
  return function<T extends { new (...args: any[]): {name: string} }>(
    originalConstructor: T
  ) {
    return class extends originalConstructor {
      constructor(..._: any[]) {
        super();
        console.log('Rendering Template');
        const hookEl = document.getElementById(hookId);
        if (hookEl) {
          hookEl.innerHTML = template;
          hookEl.querySelector('h1')!.textContent = this.name;
        }
      }
    };
  };
}
```

> ê°ì²´ì— `name` ì†ì„±ì´ ì¡´ì¬í•œë‹¤ëŠ” ì¡°ê±´ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ ì œë„ˆë¦­ì˜ ê°ì²´ ì„ ì–¸ì‹œ `{name: string}`ì„ ëª…ì‹œí•´ì£¼ì—ˆë‹¤.

### `Authbind` ë°ì½”ë ˆì´í„°
ë‹¤ë¥¸ ê°ì²´ì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë‹¤ë¥¸ í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê³ ì í• ë•Œ ì°¸ì¡°í•˜ëŠ” ê°ì²´ê°€ ìƒì´í•´ `undefined`ê°€ ì¶œë ¥ë˜ëŠ” ì´ìŠˆê°€ ìˆë‹¤.
`Authbind` ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
buttonì˜ ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆí•¨ìˆ˜ì— `p.showMessage`ë¥¼ ì¶”ê°€í•˜ë©´ `undefined`ê°€ ì¶œë ¥ë˜ë¯€ë¡œ, `Authbind`ë¥¼ í•¨ìˆ˜ ë°ì½”ë ˆì´í„°ë¡œ ì„¤ì •í•´
ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ë•Œ ì°¸ì¡°í•˜ëŠ” ê°ì²´ì¸ `this`ë¥¼ ë°”ì¸ë“œì‹œì¼œ ì‚¬ìš©í•œë‹¤. 

```typescript
function Autobind(_: any, _2: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  const adjDescriptor: PropertyDescriptor = {
    configurable: true,
    enumerable: false,
    get() {
      const boundFn = originalMethod.bind(this);
      return boundFn;
    }
  };
  return adjDescriptor;
}

class Printer {
  message = 'This works!';

  @Autobind
  showMessage() {
    console.log(this.message);
  }
}

const p = new Printer();
p.showMessage();

const button = document.querySelector('button')!;
button.addEventListener('click', p.showMessage);
```

## ë°ì½”ë ˆì´í„°ë¡œ ìœ íš¨ì„± ê²€ì¦***validation***í•˜ê¸°
ë°ì½”ë ˆì´í„°ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œ ì•„ì£¼ **ë©‹.ìˆ.ê³ **, ê¹”ë”í•œ ë°©ì‹ìœ¼ë¡œ ë°ì´í„° ìœ íš¨ì„±ê²€ì‚¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.
ìœ íš¨ì„± ê²€ì¦ì„ ìœ„í•œ ì†ì„±ì´ë¦„ì„ ë‹´ê¸° ìœ„í•œ ê·¸ë¦‡ìœ¼ë¡œ `ValidatorConfig` íƒ€ì…ì„ ì •ì˜í•˜ê³ , `registeredValidators`ë¥¼ ì„ ì–¸í•œë‹¤.
ì›ë˜ `registeredValidators`ë¥¼ ë‹´ê¸°ìœ„í•´ `...registeredValidators[target.constructor.name],`ì½”ë“œë„ ì¶”ê°€í•˜ì˜€ë‹¤.
`validate` í•¨ìˆ˜ì—ì„œëŠ” ì†ì„±ì´ë¦„ì— ë”°ë¼ ì‹¤ì§ˆì ì¸ ìœ íš¨ì„± ê²€ì¦ ë¡œì§ì„ êµ¬í˜„í•œë‹¤.
```typescript
interface ValidatorConfig {
  [property: string]: {
    [validatableProp: string]: string[]; // ['required', 'positive']
  };
}

const registeredValidators: ValidatorConfig = {};

function Required(target: any, propName: string) {
  registeredValidators[target.constructor.name] = {
    ...registeredValidators[target.constructor.name],
    [...(registeredValidators[target.constructor.name]?.[propName] ?? []), 'required']
  };
}

function PositiveNumber(target: any, propName: string) {
  registeredValidators[target.constructor.name] = {
    ...registeredValidators[target.constructor.name],
    [propName]: [...(registeredValidators[target.constructor.name]?.[propName] ?? []), 'positive']
  };
}

function validate(obj: any) {
  const objValidatorConfig = registeredValidators[obj.constructor.name];
  if (!objValidatorConfig) {
    return true;
  }
  let isValid = true;
  for (const prop in objValidatorConfig) {
    for (const validator of objValidatorConfig[prop]) {
      switch (validator) {
        case 'required':
          isValid = isValid && !!obj[prop];
          break;
        case 'positive':
          isValid = isValid && obj[prop] > 0;
          break;
      }
    }
  }
  return isValid;
}
```

ìœ„ì™€ ê°™ì´ ê²€ì¦ ë¡œì§ì„ ì¶”ê°€í•´ë‘ë©´, ê²€ì¦ë¡œì§ì„ ì‚¬ìš©í•˜ëŠ” ìª½ì—ì„œëŠ” ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ ìœ íš¨ì„±ì„ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.
í´ë˜ìŠ¤ì— ì†ì„± ë°ì½”ë ˆì´í„°ë¥¼ ëª…ì‹œí•˜ê³ , `validate(createdCourse)` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ í•„ìˆ˜ê°’ê³¼ ìˆ«ìì˜ ì–‘ìˆ˜ì—¬ë¶€ë¥¼ ê²€ì‚¬í•  ìˆ˜ ìˆë‹¤.

```typescript
class Course {
  @Required
  title: string;
  @PositiveNumber
  price: number;

  constructor(t: string, p: number) {
    this.title = t;
    this.price = p;
  }
}

const courseForm = document.querySelector('form')!;
courseForm.addEventListener('submit', event => {
  event.preventDefault();
  const titleEl = document.getElementById('title') as HTMLInputElement;
  const priceEl = document.getElementById('price') as HTMLInputElement;

  const title = titleEl.value;
  const price = +priceEl.value;

  const createdCourse = new Course(title, price);

  if (!validate(createdCourse)) {
    alert('Invalid input, please try again!');
    return;
  }
  console.log(createdCourse);
});
```
## References
- https://typescript-kr.github.io/pages/decorators.html
- https://typescript-kr.github.io/pages/decorators.html#ë©”ì„œë“œ-ë°ì½”ë ˆì´í„°-method-decorators
- https://yamoo9.gitbook.io/typescript/decorator/factory
- https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty
- https://www.udemy.com/course/understanding-typescript/#questions/8835948